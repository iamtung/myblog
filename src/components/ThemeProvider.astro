{/* Inlined to avoid FOUC. This is a parser blocking script. */}
<script is:inline>
	// Time-based theme configuration
	const LIGHT_THEME_START_HOUR = 7; // 7 AM
	const LIGHT_THEME_END_HOUR = 19; // 7 PM

	function getTimeBasedTheme() {
		const hour = new Date().getHours();
		return hour >= LIGHT_THEME_START_HOUR && hour < LIGHT_THEME_END_HOUR ? "light" : "dark";
	}

	function getUserPref() {
		const storedTheme = typeof localStorage !== "undefined" && localStorage.getItem("theme");
		// If user has manually set a theme, use that (manual override)
		// Otherwise, use time-based theme
		return storedTheme || getTimeBasedTheme();
	}

	function setTheme(newTheme) {
		if (newTheme !== "light" && newTheme !== "dark") {
			return console.warn(
				`Invalid theme value '${newTheme}' received. Expected 'light' or 'dark'.`,
			);
		}

		const root = document.documentElement;

		// root already set to newTheme, exit early
		if (newTheme === root.getAttribute("data-theme")) {
			return;
		}

		root.setAttribute("data-theme", newTheme);

		// Only save to localStorage when user manually changes theme
		// This allows the manual override to persist
	}

	// initial setup
	setTheme(getUserPref());

	// View Transitions hook to restore theme
	document.addEventListener("astro:after-swap", () => setTheme(getUserPref()));

	// listen for theme-change custom event, fired in src/components/ThemeToggle.astro
	document.addEventListener("theme-change", (e) => {
		const newTheme = e.detail.theme;
		setTheme(newTheme);
		// Save manual override to localStorage
		if (typeof localStorage !== "undefined") {
			localStorage.setItem("theme", newTheme);
		}
	});

	// Check time every minute to automatically update theme if no manual override
	setInterval(() => {
		const storedTheme = typeof localStorage !== "undefined" && localStorage.getItem("theme");
		if (!storedTheme) {
			// No manual override, update based on time
			setTheme(getTimeBasedTheme());
		}
	}, 60000); // Check every minute
</script>
